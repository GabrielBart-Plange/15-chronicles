[debug] [2026-02-23T16:15:57.477Z] ----------------------------------------------------------------------
[debug] [2026-02-23T16:15:57.480Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\gabba\AppData\Local\npm-cache\_npx\7750544ccf494d8b\node_modules\firebase-tools\lib\bin\firebase.js deploy --only firestore:rules --project chronicles-11261
[debug] [2026-02-23T16:15:57.480Z] CLI Version:   15.7.0
[debug] [2026-02-23T16:15:57.480Z] Platform:      win32
[debug] [2026-02-23T16:15:57.481Z] Node Version:  v24.12.0
[debug] [2026-02-23T16:15:57.481Z] Time:          Mon Feb 23 2026 16:15:57 GMT+0000 (Greenwich Mean Time)
[debug] [2026-02-23T16:15:57.481Z] ----------------------------------------------------------------------
[debug] 
[debug] [2026-02-23T16:15:59.676Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2026-02-23T16:15:59.676Z] > authorizing via signed-in user (bartplangegabriel76@gmail.com)
[debug] [2026-02-23T16:15:59.676Z] [iam] checking project chronicles-11261 for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2026-02-23T16:15:59.677Z] Checked if tokens are valid: true, expires at: 1771865528602
[debug] [2026-02-23T16:15:59.677Z] Checked if tokens are valid: true, expires at: 1771865528602
[debug] [2026-02-23T16:15:59.677Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/chronicles-11261:testIamPermissions [none]
[debug] [2026-02-23T16:15:59.677Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/chronicles-11261:testIamPermissions  x-goog-user-project=chronicles-11261
[debug] [2026-02-23T16:15:59.677Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/chronicles-11261:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2026-02-23T16:16:08.300Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/chronicles-11261:testIamPermissions 200
[debug] [2026-02-23T16:16:08.300Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/chronicles-11261:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'chronicles-11261'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2026-02-23T16:16:08.307Z] Checked if tokens are valid: true, expires at: 1771865528602
[debug] [2026-02-23T16:16:08.307Z] Checked if tokens are valid: true, expires at: 1771865528602
[debug] [2026-02-23T16:16:08.307Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/chronicles-11261/databases/(default) [none]
[debug] [2026-02-23T16:16:11.261Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/chronicles-11261/databases/(default) 200
[debug] [2026-02-23T16:16:11.261Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/chronicles-11261/databases/(default) {"name":"projects/chronicles-11261/databases/(default)","uid":"f0aa6819-bccc-467c-bd9a-6c889a0e370e","createTime":"2025-12-29T20:33:52.491559Z","updateTime":"2025-12-29T20:33:52.491559Z","locationId":"nam5","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2026-02-23T15:16:11.464282Z","appEngineIntegrationMode":"DISABLED","keyPrefix":"s","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IOf24raB8JIDMJLNi8i35pID"}
[info] i  firestore: reading indexes from firestore.indexes.json... 
[info] i  cloud.firestore: checking firestore.rules for compilation errors... 
[debug] [2026-02-23T16:16:11.263Z] Checked if tokens are valid: true, expires at: 1771865528602
[debug] [2026-02-23T16:16:11.263Z] Checked if tokens are valid: true, expires at: 1771865528602
[debug] [2026-02-23T16:16:11.264Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/chronicles-11261:test [none]
[debug] [2026-02-23T16:16:11.264Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/chronicles-11261:test [omitted]
[debug] [2026-02-23T16:16:11.646Z] *** [apiv2] error from fetch(https://firebaserules.googleapis.com/v1/projects/chronicles-11261:test, {"headers":{},"method":"POST","body":"{\"source\":{\"files\":[{\"name\":\"firestore.rules\",\"content\":\"rules_version = '2';\\r\\nservice cloud.firestore {\\r\\n  match /databases/{database}/documents {\\r\\n\\r\\n    // ðŸ“– Stories\\r\\n    match /stories/{storyId} {\\r\\n      allow read: if resource.data.published == true\\r\\n        || (request.auth != null && (resource.data.authorId == request.auth.uid || resource.data.creatorId == request.auth.uid));\\r\\n\\r\\n      allow create: if request.auth != null;\\r\\n\\r\\n      // Author can update/delete\\r\\n      allow update, delete: if request.auth != null\\r\\n        && (resource.data.authorId == request.auth.uid || resource.data.creatorId == request.auth.uid);\\r\\n\\r\\n      // âœ… Allow public view increments, but auth for likes/comments\\r\\n      allow update: if request.resource.data.diff(resource.data).changedKeys().hasOnly([\\\"views\\\"])\\r\\n                    || (request.auth != null && request.resource.data.diff(resource.data).changedKeys().hasOnly([\\\"likes\\\", \\\"commentCount\\\", \\\"views\\\"]));\\r\\n\\r\\n      // ðŸ”½ Subcollections\\r\\n      match /comments/{commentId} {\\r\\n        allow read: if get(/databases/$(database)/documents/stories/$(storyId))\\r\\n                        .data.published == true;\\r\\n        allow create: if request.auth != null;\\r\\n        allow delete: if request.auth != null\\r\\n          && resource.data.userId == request.auth.uid;\\r\\n      }\\r\\n\\r\\n      match /likes/{likeId} {\\r\\n        allow read: if true;\\r\\n        allow write: if request.auth != null\\r\\n          && request.auth.uid == likeId;\\r\\n      }\\r\\n    }\\r\\n\\r\\n    // ðŸ“š Novels\\r\\n    match /novels/{novelId} {\\r\\n      // FIX: Allow reading if resource is null (404) to avoid permission errors on client\\r\\n      allow read: if resource == null || resource.data.published == true\\r\\n        || (request.auth != null && (resource.data.authorId == request.auth.uid || resource.data.creatorId == request.auth.uid));\\r\\n\\r\\n      allow create: if request.auth != null;\\r\\n\\r\\n      allow update, delete: if request.auth != null\\r\\n        && (resource.data.authorId == request.auth.uid || resource.data.creatorId == request.auth.uid);\\r\\n\\r\\n      // âœ… Allow public view increments, but auth for likes/comments\\r\\n      allow update: if request.resource.data.diff(resource.data).changedKeys().hasOnly([\\\"views\\\"])\\r\\n                    || (request.auth != null && request.resource.data.diff(resource.data).changedKeys().hasOnly([\\\"likes\\\", \\\"commentCount\\\", \\\"views\\\"]));\\r\\n\\r\\n      // ðŸ”½ Subcollections\\r\\n      match /comments/{commentId} {\\r\\n        allow read: if true;\\r\\n        allow create: if request.auth != null;\\r\\n        allow delete: if request.auth != null && resource.data.userId == request.auth.uid;\\r\\n      }\\r\\n\\r\\n      match /likes/{likeId} {\\r\\n        allow read: if true;\\r\\n        allow write: if request.auth != null && request.auth.uid == likeId;\\r\\n      }\\r\\n\\r\\n      match /chapters/{chapterId} {\\r\\n        // âœ… Author can read even if not published\\r\\n        allow read: if get(/databases/$(database)/documents/novels/$(novelId))\\r\\n                        .data.published == true\\r\\n                    || (request.auth != null\\r\\n                        && get(/databases/$(database)/documents/novels/$(novelId))\\r\\n                             .data.authorId == request.auth.uid);\\r\\n\\r\\n        // âœ… Author can create/edit/delete chapters\\r\\n        allow write: if request.auth != null\\r\\n          && get(/databases/$(database)/documents/novels/$(novelId))\\r\\n               .data.authorId == request.auth.uid;\\r\\n\\r\\n        // âœ… Allow public view increments, but auth for likes/comments\\r\\n        allow update: if request.resource.data.diff(resource.data).changedKeys().hasOnly([\\\"views\\\"])\\r\\n                      || (request.auth != null && request.resource.data.diff(resource.data).changedKeys().hasOnly([\\\"likes\\\", \\\"commentCount\\\", \\\"views\\\"]));\\r\\n\\r\\n        // ðŸ”½ Chapter Subcollections\\r\\n        match /comments/{commentId} {\\r\\n          allow read: if true;\\r\\n          allow create: if request.auth != null;\\r\\n          allow delete: if request.auth != null\\r\\n            && resource.data.userId == request.auth.uid;\\r\\n        }\\r\\n\\r\\n        match /likes/{likeId} {\\r\\n          allow read: if true;\\r\\n          allow write: if request.auth != null\\r\\n            && request.auth.uid == likeId;\\r\\n        }\\r\\n      }\\r\\n    }\\r\\n\\r\\n    // ðŸ‘¤ User Profiles (Reader + Creator)\\r\\n    match /users/{userId} {\\r\\n      allow read: if true;\\r\\n      \\r\\n      // Allow creation of profile\\r\\n      allow create: if request.auth != null && request.auth.uid == userId;\\r\\n      \\r\\n      // Prevent users from granting themselves admin, premium, or modifying balances\\r\\n      allow update: if request.auth != null && request.auth.uid == userId\\r\\n        && !request.resource.data.diff(resource.data).changedKeys()\\r\\n          .hasAny(['role', 'isPremium', 'essence', 'essenceBalance', 'payoutBalance', 'level9Status']);\\r\\n          \\r\\n      // Follow System\\r\\n      match /following/{authorId} {\\r\\n        allow read: if true;\\r\\n        allow write: if request.auth != null && request.auth.uid == userId;\\r\\n      }\\r\\n\\r\\n      match /followers/{followerId} {\\r\\n        allow read: if true;\\r\\n        allow write: if request.auth != null && request.auth.uid == followerId;\\r\\n      }\\r\\n\\r\\n      // Creator drafts\\r\\n      match /drafts/{draftId} {\\r\\n        allow read, write: if request.auth != null && request.auth.uid == userId;\\r\\n        match /{allChildren=**} {\\r\\n          allow read, write: if request.auth != null && request.auth.uid == userId;\\r\\n        }\\r\\n      }\\r\\n\\r\\n      // Reader library + progress\\r\\n      // Reader library + progress\\r\\n      match /likedStories/{storyId} {\\r\\n        allow read, write: if request.auth != null && request.auth.uid == userId;\\r\\n      }\\r\\n\\r\\n      match /likedNovels/{novelId} {\\r\\n        allow read, write: if request.auth != null && request.auth.uid == userId;\\r\\n      }\\r\\n\\r\\n      match /savedNovels/{novelId} {\\r\\n        allow read, write: if request.auth != null && request.auth.uid == userId;\\r\\n      }\\r\\n\\r\\n      match /progress/{novelId} {\\r\\n        allow read, write: if request.auth != null && request.auth.uid == userId;\\r\\n      }\\r\\n    }\\r\\n\\r\\n    // ðŸ“£ Notifications (Top-level match for isolation)\\r\\n    match /users/{uid}/notifications/{docId} {\\r\\n      allow read, write: if request.auth != null && request.auth.uid == uid;\\r\\n      allow create: if request.auth != null;\\r\\n    }\\r\\n\\r\\n    // ðŸŽ¨ Art Gallery\\r\\n    match /art/{artId} {\\r\\n      allow read: if true;\\r\\n      allow create: if request.auth != null;\\r\\n      allow update, delete: if request.auth != null\\r\\n        && (resource.data.authorId == request.auth.uid || resource.data.creatorId == request.auth.uid);\\r\\n    }\\r\\n  }\\r\\n}\\r\\n\"}]}}"}): FetchError: request to https://firebaserules.googleapis.com/v1/projects/chronicles-11261:test failed, reason: getaddrinfo ENOTFOUND firebaserules.googleapis.com
[debug] [2026-02-23T16:16:16.657Z] Error: Timed out.
    at Timeout._onTimeout (C:\Users\gabba\AppData\Local\npm-cache\_npx\7750544ccf494d8b\node_modules\firebase-tools\lib\utils.js:308:49)
    at listOnTimeout (node:internal/timers:605:17)
    at process.processTimers (node:internal/timers:541:7)
[error] 
[error] Error: An unexpected error has occurred.
